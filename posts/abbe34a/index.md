# Ping网络排查


<!--more-->

### (1)ping 127.0.0.1

检查本地TCP/IP协议的安装或则运行是否存在某些最基本的问题。这是回路测试ip，ping回路测试ip时，命令被发送到本地的计算机的ip协议软件。

### (2)ping localhost

localhost是网络保留名，代表计算机本身。是127.0.0.1的别名，每台计算机都能将该名字转换成该ip地址。因此，如果使用该命令没有收到应答，表示主机文件（/windows/host）存在问题；

### (3)ping 本机ip

用于检测本地主机网卡和调制解调器（猫）是否有问题。

IP地址（Internet Protocol Address 互联网国际地址）地址划分，Excel使用

### (4)ping 局域网内其他ip

检测同网段主机间网络线路是否出现故障。该命令会经过网卡和网线发送到目的计算机，再返回。收到回送应答表明本地网络中的网卡和载体运行正常，如果收到0个回送应答，那么表示子网掩码不正确或者网卡配置错误或者网线有问题；若网络中还包含有路由器，则应先Ping路由器在本网段端口的IP，不通则此段线路有问题，通则再PING路由器在目标计算机所在网段的端口IP，不通则是路由出现故障，通则再Ping目的机IP地址。

要查看同网段正在使用的ip可以在cmd命令窗口输入for /L %i IN (1,1,254) DO ping -w 2 -n 1 10.34.0.%i

电脑突然连接不上网络诊断顺序

1.ping 127.0.0.1 先检查TCP/IP协议栈是否正常。

2.ping 本地ip 检查你网卡是否工作正常。

3.ping 网关地址 检查和网关连接性。

4.ping 远程网站 检查远程连接

## ping命令返回信息分析

### 1.Request timed out(请求超时)

（1）对方已关机或者网络上没有这个地址

（2）对方与自己不在同一个网段内，通过路由也无法找到对方

（3）对方存在但是设置了ICMP数据包过滤屏蔽（如防火墙设置）

怎么知道对方是存在还是不存在呢？可以用ping -a探测对方，如果能得到对方的NetBIOS名称，说明对方存在，但是有防火墙设置。如果得不到，多半是对方关机或者不存在，或不在同一个网段。

（4）网卡IP地址设置错误，如网卡手动设置出现问题。

### 2.Destination host Unreachable（目的主机不可达）

（1）对方和自己不在同一个网段内，而自己又没有设置默认的路由。

（2）网线出现了故障。

这里要分辨出“Destination host Unreachable”和“time out”的区别，所经过的路由器的路由表中具有到达目标的路由，而目标因为其他原因不可到达，这时候会出现“time out”，如果路由表中连到达目标的路由都没有，就会出现“Destination host Unreachable”

### 3.Bad IP address

表示可能没有连接到DNS服务器，所有没有办法解析这个ip地址，也可能是ip地址不存在。

### 4.Source quench received

表示对方或者中途的服务器繁忙无法回应。

### 5.Unknown host（不知名主机）

该远程主机名字不能被DNS服务器转换为IP地址。故障原因可能是域名服务器有问题或者其名字不正确，或者网络管理员的系统与远程主机之间的同信线路有故障。

### 6.No answer（无响应）

说明本地系统有一条通向中心主机的路由，但是却接受不到它发给中心主机的任何信息。故障原因可能是：中心主机没有工作；本地或中心主机网络配置不正确；本地或者中心的路由器没有工作；通信线路故障；中心主机存在路由选择问题。

### 7.TTL

可以通过ping返回的TTL值来判断数据报已经通过了多少个路由器。TTL的初值通常是对方系统的缺省值，每个操作系统可能不一样（但可以更改），是一个2的乘方数。那么源地点TTL的初始值减去返回时的TTL的值就是中间经过路由器的跳数。由于每个路由器至少要把TTL值减一，因此TTL通常表示包在被丢弃之前最多能经过的路由器个数。当计数到0时，路由器决定丢弃该包，并发送一个ICMP报文给最初的发送者。

例如，TTL返回值为51，那么我们可以推算数据报离开源地址的TTL初始值为64（2的6次方），所以从源地点到目的地点要通过13个路由网段（64—54）

另外TTL值还能帮我们分辨操作系统类型。例如

Unix及类Unix操作系统ICMP应答的TTL值一般为255；

Windows 2003/XP操作系统ICMP应答的TTL值一般为128；

Windows 7/8操作系统ICMP应答的TTL值一般为64；

Windows 10操作系统ICMP应答的TTL值一般为128；

Linux操作系统ICMP应答的TTL值一般为64；

MacOS/MacTCP操作系统ICMP应答的TTL值一般为60；

网络攻击者可以通过这种方式来判断别人的操作系统，以便于采用不同的策略来攻击。前提是这个初始值没有被更改过。

一个IPv6的地址使用冒号十六进制表示方法：128位的地址每16位分成一段，每个16位的段用十六进制表示并用冒号分隔开，例如：

一个普通公网IPv6地址：2001:0D12:0000:0000:02AA:0987:FE29:9871

IPv6地址支持压缩前导零的表示方法，例如上面的地址可以压缩表示为：

2001 12:0:0:2AA:987:FE29:9871

为了进一步精简IPv6地址，当冒号十六进制格式中出现连续几段数值0的位段时，这些段可以压缩为双冒号的表示，例如上面的地址还可以进一步精简表示为：

2001 12::2AA:987:FE29:9871

又例如IPv6的地址FF80:0:0:0:FF:3BA:891:67C2可以进一步精简表示为：

FE80::FF:3BA:891:67C2

这里值得注意的是：双冒号只能出现一次。

## tcp连接全过程各种状态详解

**LISTEN：侦听来自远方的TCP端口的连接请求**

**SYN-SENT：再发送连接请求后等待匹配的连接请求（客户端）**

**SYN-RECEIVED：再收到和发送一个连接请求后等待对方对连接请求的确认（服务器）**

**ESTABLISHED：代表一个打开的连接**

**FIN-WAIT-1：等待远程TCP连接中断请求，或先前的连接中断请求的确认**

**FIN-WAIT-2：从远程TCP等待连接中断请求**

**CLOSE-WAIT：等待从本地用户发来的连接中断请求**

**CLOSING：等待远程TCP对连接中断的确认**

**LAST-ACK：等待原来的发向远程TCP的连接中断请求的确认**

**TIME-WAIT：等待足够的时间以确保远程TCP接收到连接中断请求的确认**

**CLOSED：没有任何连接状态**

### tcp连接建立（tcp三握手）

TCP连接的建立采用客户-服务器模式：主动发起连接建立的应用进程叫做客户，被动等待连接建立的应用进程叫做服务器。

连接建立阶段：

**第一次握手**：客户端的应用进程主动打开，并向服务端发出请求报文段。其首部中：SYN=1,seq=x。

**第二次握手**：服务器应用进程被动打开。若同意客户端的请求，则发回确认报文，其首部中：SYN=1,ACK=1,ack=x+1,seq=y。

**第三次握手**：客户端收到确认报文之后，通知上层应用进程连接已建立，并向服务器发出确认报文，其首部：ACK=1,ack=y+1。当服务器收到客户端的确认报文之后，也通知其上层应用进程连接已建立。

在这个过程中，通信双方的状态如下图，其中CLOSED：关闭状态、LISTEN：收听状态、SYN-SENT：同步已发送、SYN-RCVD：同步收到、ESTAB-LISHED：连接已建立

至此，TCP连接就建立了，客户端和服务器可以愉快地玩耍了。只要通信双方没有一方发出连接释放的请求，连接就将一直保持。

tcp连接终止协议*（tcp四挥手）

由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。

（1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。

（2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。

（3） 服务器关闭客户端的连接，发送一个FIN给客户端。

（4） 客户端发回ACK报文确认，并将确认序号设置为收到序号加1。


---

> 作者: <no value>  
> URL: http://localhost:1313/posts/abbe34a/  

